<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" type="text/css" href="styles/style.css">
<title>OpenFAM: A library for programming Fabric-Attached Memory</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
	<header>
		<h1>OpenFAM Reference Implementation</h1>
	</header>
	<section>
		<nav>
			<ul>
				<li><a href="index.html">Home</a></li>
				<li><a href="release_notes.html">Release Notes</a></li>
				<li><a href="limitations.html">Design Choices</a></li>
				<li><a href="errors.html">Exceptions and Error Codes</a></li>
				<li><a href="services.html">Services</a></li>
				<li><a href="config_files.html">Configuration Files</a></li>
			</ul>
			<hr>
			Initialization and Finalization
			<ul>
				<li><a href="fam_initialize.html">fam_initialize</a></li>
				<li><a href="fam_finalize.html">fam_finalize</a></li>
				<li><a href="fam_abort.html">fam_abort</a></li>
			</ul>
			<hr>
			Options &amp; Query
			<ul>
				<li><a href="fam_list_options.html">fam_list_options</a></li>
				<li><a href="fam_get_option.html">fam_get_option</a></li>
				<li><a href="fam_lookup.html">fam_lookup</a></li>
				<li><a href="fam_stat.html">fam_stat</a></li>
			</ul>
			<hr>
			Memory Allocation
			<ul>
				<li><a href="fam_create_region.html">fam_create_region</a></li>
				<li><a href="fam_destroy_region.html">fam_destroy_region</a></li>
				<li><a href="fam_resize_region.html">fam_resize_region</a></li>
				<li><a href="fam_allocate.html">fam_allocate</a></li>
				<li><a href="fam_deallocate.html">fam_deallocate</a></li>
				<li><a href="fam_change_permissions.html">fam_change_permissions</a></li>
				<li><a href="fam_close.html">fam_close</a></li>
			</ul>
			<hr>
			Memory Map
			<ul>
				<li><a href="fam_map.html">fam_map</a></li>
				<li><a href="fam_unmap.html">fam_unmap</a></li>
			</ul>
			<hr>
			Data Path Operations
			<ul>
				<li><a href="fam_get.html">fam_get</a></li>
				<li><a href="fam_put.html">fam_put</a></li>
				<li><a href="fam_gather.html">fam_gather</a></li>
				<li><a href="fam_scatter.html">fam_scatter</a></li>
				<li><a href="fam_copy.html">fam_copy</a></li>
				<li><a href="fam_copy_wait.html">fam_copy_wait</a></li>
				<li><a href="fam_backup.html">fam_backup</a></li>
				<li><a href="fam_backup_wait.html">fam_backup_wait</a></li>
				<li><a href="fam_restore.html">fam_restore</a></li>
				<li><a href="fam_restore_wait.html">fam_restore_wait</a></li>
				<li><a href="fam_delete_backup.html">fam_delete_backup</a></li>
				<li><a href="fam_delete_backup_wait.html">fam_delete_backup_wait</a></li>
			</ul>
			<hr>
			Atomics
			<ul>
				<li><a href="fam_set.html">fam_set</a></li>
				<li><a href="fam_add.html">fam_add</a></li>
				<li><a href="fam_subtract.html">fam_subtract</a></li>
				<li><a href="fam_min.html">fam_min</a></li>
				<li><a href="fam_max.html">fam_max</a></li>
				<li><a href="fam_and.html">fam_and</a></li>
				<li><a href="fam_or.html">fam_or</a></li>
				<li><a href="fam_xor.html">fam_xor</a></li>
				<li><a href="fam_fetch_TYPE.html">fam_fetch_TYPE</a></li>
				<li><a href="fam_swap.html">fam_swap</a></li>
				<li><a href="fam_compare_swap.html">fam_compare_swap</a></li>
				<li><a href="fam_fetch_add.html">fam_fetch_add</a></li>
				<li><a href="fam_fetch_subtract.html">fam_fetch_subtract</a></li>
				<li><a href="fam_fetch_min.html">fam_fetch_min</a></li>
				<li><a href="fam_fetch_and.html">fam_fetch_and</a></li>
				<li><a href="fam_fetch_max.html">fam_fetch_max</a></li>
				<li><a href="fam_fetch_or.html">fam_fetch_or</a></li>
				<li><a href="fam_fetch_xor.html">fam_fetch_xor</a></li>
			</ul>
			<hr>
			Ordering
			<ul>
				<li><a href="fam_barrier_all.html">fam_barrier_all</a></li>
				<li><a href="fam_fence.html">fam_fence</a></li>
				<li><a href="fam_quiet.html">fam_quiet</a></li>
				<li><a href="fam_progress.html">fam_progress</a></li>
				<li><a href="fam_context_open.html">fam_context_open</a></li>
				<li><a href="fam_context_close.html">fam_context_close</a></li>
			</ul>
			<hr>
		</nav>
		<article>
		<h1>Configuration Files</h1>
<p>The OpenFAM environment uses four separate configuration files, three for the memory and metadata services, and one for the OpenFAM client.
 <ol>
 <li><b>fam_client_interface_config.yaml</b>: Configures the client interface service.</li>
 <li><b>fam_memoryserver_config.yaml</b>: Configures the memory servers.</li>
 <li><b>fam_metadata_config.yaml</b>: Configures the metadata management service.</li>
 <li><b>fam_pe_config.yaml</b>: Configures the OpenFAM clients.</li>
 </ol>
These configuration files contain the following options.
<p>1. fam_client_interface_config.yaml
<table>
<tbody>
	<tr><th>Configuration Name</th><th>Description</th></tr>
	<tr><td class="code">memsrv_interface_type</td>
		<td>Memory server interface type used by OpenFAM. Default value is "direct". Other option is "rpc".
		</td>
	</tr>
	<tr><td class="code">metadata_interface_type</td>
		<td>Metadata server interface type used by OpenFAM. Default value is "direct". Other option is "rpc".
		</td>
	</tr>
	<tr><td class="code">rpc_interface</td>
		<td> IP address/hostname of Client Interface Service, followed by port number.
		</td>
	</tr>
	<tr><td class="code">memsrv_list</td>
		<td>List of memory servers. Applicable only if memsrv_interface_type is rpc. Each list entry is given
		in this format:<p> &lt;memsrv_id&gt;:&lt;host_address&gt;:&lt;port_no&gt;
		</td>
	</tr>
	<tr><td class="code">metadata_list</td>
		<td>List of metadata servers. Applicable only if metadata_interface_type is rpc. Each list entry is given
		in this format:<p> &lt;metadataserver_id&gt;:&lt;host_address&gt;:&lt;port_no&gt;
		</td>
	</tr>
	<tr><td class="code">rpc_framework_type</td>
		<td> The control path operations can leverage thallium libraries instead of grpc. Default value is "grpc". Other option is "thallium".
		</td>
	</tr>
	<tr><td class="code">provider</td>
		<td> If "thallium" option is chosen for rpc_framework_type, it is essential to provide details of provider. Default value is "cxi". Other option is "sockets".
		</td>
	</tr>
</tbody>
</table>
<p>2. fam_memoryserver_config.yaml
<table>
<tbody>
	<tr><th>Configuration Name</th><th>Description</th></tr>
	<tr><td class="code">provider</td>
		<td>Libfabric provider to be used by OpenFAM libfabric data path operations. Default value is "sockets".
		Other supported options are "cxi", "psm2" and "verbs".
		</td>
	</tr>
	<tr><td class="code">delayed_free_threads</td>
		<td>Number of threads used for delayed free.
		</td>
	</tr>
	<tr><td class="code">ATL_threads</td>
		<td> Atomic library threads count. Default value is 0, which indicates ATL is disabled.
		</td>
	</tr>
	<tr><td class="code">ATL_queue_size</td>
		<td> ATL queue size. Number of elements in each queue. Default value is 1000.
		</td>
	</tr>
	<tr><td class="code">ATL_data_size</td>
		<td> ATL data size per thread(MiB). This is used to allocate buffers and other queue related data structures.
		Default data size is 1024.		
		</td>
	</tr>
	<tr><td class="code">fam_backup_path</td>
		<td> Absolute path used by the memory server to store archives.
		Default value is config file location.		
		</td>
	</tr>
	<tr><td class="code">memory_type</td>
		<td> Type of memory used by the memory server to host FAM.
		Options are "volatile" or "persistent".
		Default value is "volatile".		
		</td>
	</tr>
	<tr><td class="code">fam_path</td>
		<td> Absolute path to the NVMM data files used by the memory server.
		Default value is an empty string.		
		</td>
	</tr>
	<tr><td class="code">rpc_interface</td>
		<td> IP address/hostname of memory server, followed by port number.
		Default value is an "127.0.0.1:8789".		
		</td>
	</tr>
	<tr><td class="code">resource_release</td>
		<td> This option is to enable or disable resource relinquishment in FAM.
		Default value is "enable".		
		</td>
	</tr>
	<tr><td class="code">libfabric_port</td>
		<td>Libfabric port to be used for data path operations.
		</td>
	<tr><td class="code">if_device</td>
		<td>NIC name to be used with memory server.
		    Default value is "eth0".
		</td>
	</tr>
	<tr><td class="code">rpc_framework_type</td>
		<td> The control path operations can leverage thallium libraries instead of grpc. Default value is "grpc". Other option is "thallium".
		</td>
	</tr>
	<tr><td class="code">provider</td>
		<td> The control path operations can leverage thallium libraries instead of grpc. If "thallium" option is chosen for rpc_framework_type, it is essential to provide provider details. Default value is "cxi". Other option is "sockets".
		</td>
	</tr>
	</tr>
</tbody>
</table>
<p>3. fam_metadata_config.yaml
<table>
<tbody>
	<tr><th>Configuration Name</th><th>Description</th></tr>
	<tr><td class="code">metadata_manager</td>
		<td> Metadata manager type used by metadata server. Default is radixtree. Currently radixtree is the only supported KVS.		
		</td>
	</tr>
	<tr><td class="code">metadata_path</td>
		<td> Absolute path where metadata info is stored. By default, it will be placed in /dev/shm/&lt;metadata_manager>.
		Example: If metadata manager is radixtree, then metadata info would be placed under /dev/shm/radixtree folder.
		</td>
	</tr>
	<tr><td class="code">enable_region_spanning</td>
		<td> Flag to enable or disable region spanning. By default, it is set to true.
		</td>
	</tr>
	<tr><td class="code">region_span_size_per_memoryserver</td>
		<td> Region size per memory server (Bytes). Used only if region spanning is enabled.
		Default value is 1073741824.
		</td>
	</tr>
	<tr><td class="code">dataitem_interleave_size</td>
		<td>  Data interleaving refers to interspersing portions of the data across the memory servers in some specified order or other arrangement. dataitem_interleave_size decides the number of bytes after which data item needs to be striped so that it gets distributed across several memory servers. Default value is "1048576".</td>
	</tr>
	<tr><td class="code">rpc_framework_type</td>
		<td> The control path operations can leverage thallium libraries instead of grpc. Default value is "grpc". other option is "thallium".
		</td>
	</tr>
	<tr><td class="code">provider</td>
		<td> If "thallium" option is chosen for rpc_framework_type, it is essential to provide provider details. Default value is "cxi". Other option is "sockets".
		</td>
	</tr>
</tbody>
</table>
<p>4. fam_pe_config.yaml
<table>
<tbody>
	<tr><th>Configuration Name</th><th>Description</th></tr>
	<tr><td class="code">FamThreadModel</td>
		<td> Fam thread model used by OpenFAM. Default value is "single". OpenFAM supports single and multi-threaded model.
		</td>
	</tr>
	<tr><td class="code">provider</td>
		<td> Libfabric provider to be used by OpenFAM libfabric data path operations. Default value is "sockets".
		Other supported options are "cxi", "psm2" and "verbs".
		</td>
	</tr>
	<tr><td class="code">runtime</td>
		<td> Runtime option used for OpenFAM. Default value is "PMIX". Other supported options are "PMI2" and "NONE"
		</td>
	</tr>
	<tr><td class="code">client_interface_type</td>
		<td> Client interface type used by OpenFAM. Default value is "direct". Other option is "rpc"
		</td>
	</tr>
	<tr><td class="code">fam_client_interface_service_address</td>
		<td> Address of Client Interface Service. Value is specified in this format: &lt;ip_address>:&lt;port_no>.
		Applicable only if client_interface_type is rpc. Default value is "127.0.0.1:8787"
		</td>
	</tr>
	<tr><td class="code">rpc_framework_type</td>
		<td> The control path operations can also leverage thallium libraries instead of grpc. Default value is "grpc". other option is "thallium".
		</td>
	</tr>
	<tr><td class="code">openfam_model</td>
		<td> Openfam_model specifies if memory servers are resident in same nodes as clients (shared_memory mode) or distributed across nodes other than client. Default value is "memory_server". Other option is "shared_memory".
		</td>
	</tr>
	<tr><td class="code">resource_release</td>
		<td> This option is to enable or disable resource relinquishment in FAM. Default value is "enable". Other option is "disable".
		</td>
	</tr>
</tbody>
</table>
<p>Sample configuration files are provided in the source under <code>openfam_parent_directory/config</code>.</p>
<h1>Starting Services</h1>
<p> All the services and the PE read the respective configuration file from "config" directory placed at the path mentioned
by <code>OPENFAM_ROOT</code> environment variable.</p>
<p> Or by default, <code>OPENFAM_ROOT</code> will be <code>/opt/hpe/OpenFAM</code>.</p>
<p> User needs to update this environment variable to select config folder created by them.</p>
<p> A tool by name <code>openfam_adm</code> has been introduced which helps to perform the basic tasks useful to an OpenFAM user such as </p>
<ol>
<li>creating configuration files </li>
<li>starting OpenFAM services </li>
<li>terminating OpenFAM services</li>
<li>running tests and </li>
<li>cleanup FAM and metadata. </li>
</ol>
<p>To access the tool, the openfam module must be loaded. That can be done using following command: </p>

<code>module load openfam</code>

<p>The detailed description and available options are given below.</p>
<p>The details of available command line options can be found using <code>-h</code> option of each of the service executable.
For Example:</p>
<pre>#<text style="background-color:LightGrey;">openfam_adm -h</text>
Usage :
       openfam_adm [-h] [--create_config_files] [--start_service]
                                    [--stop_service] [--clean] [--install_path]
                                    [--config_file_path] [--launcher]
                                    [--global_launcher_options] [--cisinterface]
                                    [--memserverinterface] [--metaserverinterface]
                                    [--cisserver id:{comma separated attributes}]
                                    [--memservers  id:{comma seperated attributes}]
                                    [--metaservers  id:{comma seperated attributes}]
                                    [--test_args] [--model] [--thrdmodel] [--provider]
                                    [--provider] [--runtime] [--kvstype]
                                    [--libfabricport] [--metapath] [--fampath]
                                    [--fam_backup_path] [--atlthreads] [--atlqsize]
                                    [--atldatasize] [--disableregionspanning]
                                    [--regionspanningsize] [--interleaveblocksize]
                                    [--runtests] [--sleep] [--rpc_framework]
                                    [--disable_resource_release]

Options :
       optional arguments:
         -h, --help            show this help message and exit
         --create_config_files
                               Generates all configuration files
         --start_service       Start all OpenFAM services
         --stop_service        Stop all OpenFAM services
         --clean               Clean all FAMs and Metadata
         --install_path        Path to OpenFAM installation dir
         --config_file_path    Path to create configuration files
         --launcher            Launcher to be used to launch processes(mpi/slurm)
         --global_launcher_options
                               Launcher command options which can be used commonly
                               across all services. Specify all options within
                               quotes(") eg : --global_launcher_options="-N" "1" "--
                               mpi=pmix"
         --cisinterface        CIS interface type(rpc/direct)
         --memserverinterface
                               Memory Service interface type(rpc/direct)
         --metaserverinterface
                               Metadata Service interface type(rpc/direct)
         --cisserver           CIS parameters, eg : ,0:{rpc_interface:127.0.0.1,rpc_p
                               ort:8795,launcher_options: "-n" "1"}. Note : Specify
                               all launcher options within quotes(") eg :
                               launcher_options:"-N" "1" "--mpi=pmix"
         --memservers  id:{comma seperated attributes}
                               Add a new memory server, eg : 0:{memory_type:volatile,
                               fam_path:/dev/shm/vol/,rpc_interface:127.0.0.1,rpc_por
                               t:8795,libfabric_port:7500,if_device:eth0,launcher_opt
                               ions: '-n' '1'}. Note : Specify all launcher options
                               within quotes(") eg : launcher_options: "-N" "1" "--
                               mpi=pmix"
         --metaservers  id:{comma seperated attributes}
                               Add a metadata server, eg : 0:{rpc_interface:127.0.0.1
                               ,rpc_port:8795,launcher_options: '-n' '1'}. Note :
                               Specify all launcher options within quotes(") eg :
                               launcher_options: "-N" "1" "--mpi=pmix"
         --test_args           Test configuration parameters, eg :
                               ,0:{num_pes:1,launcher_options: '-n' '1'}. Note :
                               Specify all launcher options within quotes(") eg :
                               launcher_options: "-N" "1" "--mpi=pmix"
         --model               OpenFAM model(memory_server/shared_memory)
         --thrdmodel           Thread model(single/multiple)
         --provider            Libfabric provider to be used for data path operations
         --runtime             Runtime process management interface(PMI) to be used
         --kvstype             Type of key value store to be used for metadata
                               management
         --libfabricport       Libafabric port for data path operation
         --metapath            path to store metadata
         --fampath             path where data is stored
         --fam_backup_path     path where data backup is stored(on shared filesystem)
         --atlthreads          Atomic library threads count
         --atlqsize            ATL queue size
         --atldatasize         ATL data size per thread(MiB)
         --disableregionspanning
                               Disable region spanning
         --regionspanningsize
                               Region spanning size
         --interleaveblocksize
                               Dataitem interleave block size
         --runtests            Run regression and unit tests
         --sleep               Number of seconds to sleep
         --rpc_framework       RPC Framework type(grpc/thallium)
         --disable_resource_release 
                               Disable the resource relinquishment in FAM


For Example, following commands are primarily used to create configuration files, start/stop OpenFAM services and cleanup the FAM and metadata:

       - Generate Configuration Files (Only one time step)

       $openfam_adm @arg_file --create_config_files --config_file_path=/path/to/generate/config/files

       Content of sample "arg_file" :
         --launcher=slurm
         --model=memory_server
         --cisinterface=rpc
         --memserverinterface=rpc
         --metaserverinterface=rpc
         --provider=cxi
         --cisserver={rpc_interface:node1,rpc_port:8787}
         --memservers=0:{memory_type:volatile,fam_path:/dev/shm/vol,rpc_interface:node2,rpc_port:8793,libfab-
       ric_port:7500,if_device:eth0}
         --metaservers=0:{rpc_interface:node3,rpc_port:8788}
         --global_launcher_options="-p" "nodes" "--mpi=pmix"

       - Export path of config files dir

       $export OPENFAM_ROOT=/path/to/generate/config/files

       - Start/Stop OpenFAM Services

       $openfam_adm --start_service

       - Stop OpenFAM Services

       $openfam_adm --stop_service

       - Cleanup

       $openfam_adm --clean


</pre>
<p>The configuration options passed to the services using command line arguments take precedence over
the options present in the respective configuration files.</p>
<p>Similarly, for the PE, configuration options passed using <code>Fam_Options</code> argument of <a href="fam_initialize.html">fam_initialize</a> API take precedence
over the options present in <code>fam_pe_config.yaml</code> configuration file. </article>
	</section>
	<footer>
		<p>Copyright 2021-23, Hewlett Packard Enterprise Development Co, LLP</p>
	</footer>
</body>
</html>
