<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" type="text/css" href="styles/style.css">
<title>OpenFAM: A library for programming Fabric-Attached Memory</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
	<header>
		<h1>OpenFAM Reference Implementation</h1>
	</header>
	<section>
		<nav>
			<ul>
				<li><a href="index.html">Home</a></li>
				<li><a href="release_notes.html">Release Notes</a></li>
				<li><a href="limitations.html">Design Choices</a></li>
				<li><a href="errors.html">Exceptions and Error Codes</a></li>
				<li><a href="services.html">Services</a></li>
				<li><a href="config_files.html">Configuration Files</a></li>
			</ul>
			<hr>
			Initialization and Finalization
			<ul>
				<li><a href="fam_initialize.html">fam_initialize</a></li>
				<li><a href="fam_finalize.html">fam_finalize</a></li>
				<li><a href="fam_abort.html">fam_abort</a></li>
			</ul>
			<hr>
			Options &amp; Query
			<ul>
				<li><a href="fam_list_options.html">fam_list_options</a></li>
				<li><a href="fam_get_option.html">fam_get_option</a></li>
				<li><a href="fam_lookup.html">fam_lookup</a></li>
				<li><a href="fam_stat.html">fam_stat</a></li>
			</ul>
			<hr>
			Memory Allocation
			<ul>
				<li><a href="fam_create_region.html">fam_create_region</a></li>
				<li><a href="fam_destroy_region.html">fam_destroy_region</a></li>
				<li><a href="fam_resize_region.html">fam_resize_region</a></li>
				<li><a href="fam_allocate.html">fam_allocate</a></li>
				<li><a href="fam_deallocate.html">fam_deallocate</a></li>
				<li><a href="fam_change_permissions.html">fam_change_permissions</a></li>
				<li><a href="fam_close.html">fam_close</a></li>
			</ul>
			<hr>
			Memory Map
			<ul>
				<li><a href="fam_map.html">fam_map</a></li>
				<li><a href="fam_unmap.html">fam_unmap</a></li>
			</ul>
			<hr>
			Data Path Operations
			<ul>
				<li><a href="fam_get.html">fam_get</a></li>
				<li><a href="fam_put.html">fam_put</a></li>
				<li><a href="fam_gather.html">fam_gather</a></li>
				<li><a href="fam_scatter.html">fam_scatter</a></li>
				<li><a href="fam_copy.html">fam_copy</a></li>
				<li><a href="fam_copy_wait.html">fam_copy_wait</a></li>
                                <li><a href="fam_backup.html">fam_backup</a></li>
                                <li><a href="fam_backup_wait.html">fam_backup_wait</a></li>
                                <li><a href="fam_restore.html">fam_restore</a></li>
                                <li><a href="fam_restore_wait.html">fam_restore_wait</a></li>
                                <li><a href="fam_delete_backup.html">fam_delete_backup</a></li>
                                <li><a href="fam_delete_backup_wait.html">fam_delete_backup_wait</a></li>

			</ul>
			<hr>
			Atomics
			<ul>
				<li><a href="fam_set.html">fam_set</a></li>
				<li><a href="fam_add.html">fam_add</a></li>
				<li><a href="fam_subtract.html">fam_subtract</a></li>
				<li><a href="fam_min.html">fam_min</a></li>
				<li><a href="fam_max.html">fam_max</a></li>
				<li><a href="fam_and.html">fam_and</a></li>
				<li><a href="fam_or.html">fam_or</a></li>
				<li><a href="fam_xor.html">fam_xor</a></li>
				<li><a href="fam_fetch_TYPE.html">fam_fetch_TYPE</a></li>
				<li><a href="fam_swap.html">fam_swap</a></li>
				<li><a href="fam_compare_swap.html">fam_compare_swap</a></li>
				<li><a href="fam_fetch_add.html">fam_fetch_add</a></li>
				<li><a href="fam_fetch_subtract.html">fam_fetch_subtract</a></li>
				<li><a href="fam_fetch_min.html">fam_fetch_min</a></li>
				<li><a href="fam_fetch_and.html">fam_fetch_and</a></li>
				<li><a href="fam_fetch_max.html">fam_fetch_max</a></li>
				<li><a href="fam_fetch_or.html">fam_fetch_or</a></li>
				<li><a href="fam_fetch_xor.html">fam_fetch_xor</a></li>
			</ul>
			<hr>
			Ordering
			<ul>
				<li><a href="fam_barrier_all.html">fam_barrier_all</a></li>
				<li><a href="fam_fence.html">fam_fence</a></li>
				<li><a href="fam_quiet.html">fam_quiet</a></li>
                                <li><a href="fam_progress.html">fam_progress</a></li>
                                <li><a href="fam_context_open.html">fam_context_open</a></li>
                                <li><a href="fam_context_close.html">fam_context_close</a></li>

			</ul>
			<hr>
		</nav>
		<article>
			<h1 class="code">openfam::fam::fam_allocate</h1>
	<p>Allocate a data item in a region of FAM.</p>
	<h2>Synopsis</h2>
	<p class="code">
		Fam_Descriptor *fam_allocate(char *name, uint64_t nbytes, mode_t
		accessPermissions, Fam_Region_Descriptor *region);<br>
		Fam_Descriptor *fam_allocate(uint64_t nbytes, mode_t
		accessPermissions, Fam_Region_Descriptor *region);
	</p>
	<h2>Description</h2>
	<p>These methods allocate space for a data item in some region of
		FAM.</p>
	<h2>Input Arguments</h2>
	<table>
		<tbody>
			<tr><th>Name</th><th>Description</th></tr>
			<tr><td class="code">name</td><td>Name of the data item for subsequent references.</td></tr>
			<tr><td class="code">nbytes</td><td>Requested size of the data item in bytes.</td></tr>
			<tr><td class="code">accessPermissions</td><td>Access permissions for this data item.</td></tr>
			<tr><td class="code">region</td><td>
					Descriptor for the region where the data item is being
					created.</td></tr>
		</tbody>
	</table>
	<p>&nbsp;</p>
	<h2>Return Values</h2>
	<p>Descriptor to the allocated data item. Throws <code>Fam_Exception</code> on error.</p>
	<h2>Fam Error numbers</h2>
	<table>
	<tbody>
	<tr><th>Error</th><th>Description</th></tr>
	<tr><td class="code">FAM_ERR_NOPERM</td><td>Caller does not have access rights.</td></tr>
	<tr><td class="code">FAM_ERR_ALREADYEXIST</td><td>Data item name is already present in FAM.</td></tr>
	<tr><td class="code">FAM_ERR_NAME_TOO_LONG</td><td>Data item name too long.</td></tr>
	<tr><td class="code">FAM_ERR_RPC</td><td>Communication error from grpc layer.</td></tr>
	<tr><td class="code">FAM_ERR_RPC_CLIENT_NOTFOUND</td><td>RPC service not available.</td></tr>
	<tr><td class="code">FAM_ERR_METADATA</td><td>Metadata service error.</td></tr>
	<tr><td class="code">FAM_ERR_MEMORY</td><td>Memory service error.</td></tr>
	<tr><td class="code">FAM_ERR_RESOURCE</td><td>Resource not available.</td></tr>
	</tbody>
	</table>
	<h2>Notes</h2>
	<p>Note that these methods may allocate space greater than the
		requested size to maintain an implementation dependent byte alignment.
		The allocated space is zeroed out during allocation. If a name is
		provided during allocation, it can be used within subsequent calls to
		<code>fam_lookup()</code> to retrieve the associated descriptor. If a name is not
		provided during allocation, then the program itself is responsible for
		saving and tracking the descriptor if required later, since the data
		in FAM will be unreachable without the descriptor. Also note that at present maximum data item name
		length supported is 40 characters.</p>
	<p><code>Fam_Descriptor</code> provides a method to retrieve an opaque read-only data structure called 
	<code>Fam_Global_Descriptor</code> which represents both the region and data item in FAM. <code>Fam_Global_Descriptor</code>
	can be freely copied, and shared across processing nodes by the program, and is portable
	across operating system and program instances.</p>
<pre>
// Fam_Global_Descriptor Fam_Descriptor::get_global_descriptor();
Fam_Global_Descriptor gDescriptor = famDescriptor->get_global_descriptor();
</pre>
	<p><code>Fam_Descriptor</code> can be instantiated from <code>Fam_Global_Descriptor</code> using the following constructor.</p>
<pre>
// Fam_Descriptor::Fam_Descriptor(Fam_Global_Descriptor gDescriptor);
Fam_Descriptor *dataItem = new Fam_Descriptor(gDescriptor);
</pre>

	<h2 id="e1">Example</h2>
<pre>
#include &lt;string.h&gt;
#include &lt;fam/fam.h&gt;
#include &lt;fam/fam_exception.h&gt;
using namespace std;
using namespace openfam;

int main(void) {
	fam *myFam = new fam();
	// ... Initialization code here

	try {
		Fam_Region_Descriptor *region = myFam-&gt;fam_lookup_region("myRegion");
		// create 50 element unnamed integer array in FAM with 0600
		// (read/write by owner) permissions in myRegion
		Fam_Descriptor *descriptor = myFam-&gt;fam_allocate((uint64_t)(50 * sizeof(int)), 0600, region);

		printf("Successfully allocated 50 unnamed integer elements\n");

		// free allocated space in FAM
		myFam-&gt;fam_deallocate(descriptor);
		printf("Successfully de-allocated 50 unnamed integer elements\n");
	} catch (Fam_Exception &amp;e) {
		printf("fam API failed: %d: %s\n", e.fam_error(), e.fam_error_msg());
	 }
	 // ... Finalization code here
}
</pre>
		</article>
	</section>
	<footer>
		<p>Copyright 2021-23, Hewlett Packard Enterprise Development Co, LLP</p>
	</footer>
</body>
</html>
